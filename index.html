<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Shark Menu</title>
<style>
html, body {
  margin:0;padding:0;
  background:transparent;
  overflow:hidden;
  width:800px;height:600px;
  font-family:Arial,sans-serif;
}
.menu {
  width:360px;
  background:rgba(0,0,0,.2);
  color:#fff;
  display:flex;
  flex-direction:column;
  border:2px solid #666;
  border-radius:10px;
  overflow:hidden;
}
.menu-header {background:rgba(0,0,0,.85);padding:8px 20px;font-weight:700;}
.menu-section {background:rgba(0,0,0,.35);flex-grow:1;overflow-y:auto;}
.menu-item,.submenu-item {
  padding:10px 20px;
  display:flex;
  justify-content:space-between;
  border-bottom:1px solid rgba(255,255,255,.08);
}
.active {background:rgba(128,128,128,.35);color:#fff;}
.switch {position:relative;display:inline-block;width:34px;height:18px;}
.switch input {display:none;}
.slider {
  position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;
  background:#555;transition:.2s;border-radius:34px;
}
.slider:before {
  position:absolute;content:"";height:14px;width:14px;left:2px;bottom:2px;
  background:white;transition:.2s;border-radius:50%;
}
input:checked+.slider {background:#4ade80;}
input:checked+.slider:before {transform:translateX(16px);}
.dot {width:10px;height:10px;background:#aaa;border-radius:50%;display:inline-block;}
.value {display:flex;align-items:center;}
.value span:last-child {font-size:0.9em;color:#ccc;}
</style>
</head>
<body>
<div class="menu">
  <div class="menu-header" id="menuTitle">Main menu</div>
  <div class="menu-section" id="mainMenu"></div>
  <div class="menu-section" id="submenu" style="display:none;"></div>
</div>

<script>
let mainMenu=document.getElementById("mainMenu");
let submenu=document.getElementById("submenu");
let menuTitle=document.getElementById("menuTitle");
let items=[],submenuItems=[];
let index=0,subIndex=0;

function updateSelection(){
  [...mainMenu.children].forEach((el,i)=>el.classList.toggle("active",i===index));
}
function updateSubSelection(){
  [...submenu.children].forEach((el,i)=>el.classList.toggle("active",i===subIndex));
}
function updateToggleUI(el,state){
  const input=el.querySelector("input[type=checkbox]");
  if(input) input.checked=state;
}
function updateValueUI(el,state,range){
  const valueSpan=el.querySelector(".value span:last-child");
  if(valueSpan){
    let displayState=typeof state==="object"?`X:${state.x},Y:${state.y}`:state;
    valueSpan.textContent=`${displayState} [${range}]`;
  }
}

window.addEventListener("message",(ev)=>{
  const d=ev.data; if(!d||!d.type) return;
  switch(d.type){
    case "setTitle":
      menuTitle.textContent=d.text||"Main menu"; break;
    case "setItems": {
      items=d.items||[];
      mainMenu.innerHTML=items.map((f,i)=>`<div class="menu-item${i===index?" active":""}" data-feature="${f}"><span>${f}</span><span>></span></div>`).join("");
      break;
    }
    case "selectIndex": index=d.index||0; updateSelection(); break;
    case "setSubmenu": {
      submenuItems=d.items||[];
      const states=d.states||{};
      submenu.innerHTML=submenuItems.map((f,i)=>{
        const stateData=states[f]||{type:"button"};
        if(stateData.type==="toggle"){
          const state=!!stateData.state;
          return `<div class="submenu-item${i===0?" active":""}" data-feature="${f}" data-type="toggle">
                   <span>${f}</span>
                   <label class="switch">
                     <input type="checkbox" ${state?"checked":""}>
                     <span class="slider"></span>
                   </label>
                 </div>`;
        } else if(stateData.type==="value"){
          let range=stateData.values?stateData.values.join("/"):stateData.min!==undefined?`${stateData.min}-${stateData.max}`:"";
          let displayState=typeof stateData.state==="object"?`X:${stateData.state.x},Y:${stateData.state.y}`:stateData.state;
          return `<div class="submenu-item${i===0?" active":""}" data-feature="${f}" data-type="value">
                   <span>${f}</span>
                   <span class="value"><span>${displayState} [${range}]</span></span>
                 </div>`;
        } else {
          return `<div class="submenu-item${i===0?" active":""}" data-feature="${f}" data-type="button">
                   <span>${f}</span><span class="dot"></span>
                 </div>`;
        }
      }).join("");
      break;
    }
    case "openSubmenu":
      mainMenu.style.display="none";
      submenu.style.display="block";
      subIndex=0; updateSubSelection();
      break;
    case "closeSubmenu":
      submenu.style.display="none";
      mainMenu.style.display="block";
      break;
    case "selectSub": subIndex=d.index||0; updateSubSelection(); break;
    case "featureState": {
      const name=d.name,state=d.state,type=d.type;
      [...submenu.children].forEach(el=>{
        if(el.dataset.feature===name){
          if(type==="toggle"){
            updateToggleUI(el,state);
          } else if(type==="value"){
            let range=d.values?d.values.join("/"):d.min!==undefined?`${d.min}-${d.max}`:"";
            updateValueUI(el,state,range);
          }
        }
      });
      break;
    }
  }
});
</script>
</body>
</html>
